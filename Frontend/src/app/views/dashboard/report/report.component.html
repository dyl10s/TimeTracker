<div class="container">
    <h2>Reports</h2>
    <app-time-frame-picker [(startDate)]="startDate" [(endDate)]="endDate" (datesChanged)="datesChanged($event)"></app-time-frame-picker>
    <h4>Projects</h4>

    <div class="filter-section">
        <span>
          <input [(ngModel)]="searchQuery" nbInput [nbFilterInput]="showActive ? activeDataSource : archivedDataSource" id="search" placeholder="Search">
        </span>
        <span>
          <nb-button-group size="small">
            <button nbButtonToggle pressed (click)="viewActiveProjects()">Active Projects</button>
            <button nbButtonToggle (click)="viewArchivedProjects()">Archived Projects</button>
          </nb-button-group>
        </span>
      </div>

    <table [nbTreeGrid]="showActive ? activeDataSource : archivedDataSource" [nbFilter]="" [nbSpinner]="showLoadingSpinner">
        <tr nbTreeGridHeaderRow *nbTreeGridHeaderRowDef="gridHeaders"></tr>
        <tr nbTreeGridRow *nbTreeGridRowDef="let row; columns: gridHeaders"></tr>
    
        <ng-container nbTreeGridColumnDef="name">
            <th nbTreeGridHeaderCell *nbTreeGridHeaderCellDef>
                Name
            </th>
            <td nbTreeGridCell *nbTreeGridCellDef="let row">

                <nb-tree-grid-row-toggle [expanded]="row.expanded" *ngIf="row.children">
                </nb-tree-grid-row-toggle>

                <label class="header-row" *ngIf="row.data.name">{{row.data.name}}</label>
                <label *ngIf="!row.data.name">{{row.data.firstName + " " + row.data.lastName}}</label>
            </td>
        </ng-container>

        <ng-container nbTreeGridColumnDef="hours">
            <th nbTreeGridHeaderCell *nbTreeGridHeaderCellDef>
                Hours
            </th>
            <td nbTreeGridCell *nbTreeGridCellDef="let row">
                <label class="header-row" *ngIf="row.data.name">{{row.data.hours}}</label>
                <div class="hours-breakdown" *ngIf="!row.data.name">
                    <label>
                        {{row.data.hours}}
                    </label>
                    <button [routerLink] = "'/dashboard/reports/' + row.data.projId +'/'+ row.data.userId" nbButton status="primary">
                        <nb-icon class="adaptive-button-icon" icon="bar-chart"></nb-icon>
                        <span class="adaptive-button-text">Detailed Report</span>
                    </button>
                </div>
            </td>
        </ng-container>
    </table>

    <div id="help"  [nbPopover]="popoverTemplate" nbPopoverTrigger="hint">
        <nb-icon icon="question-mark-circle"></nb-icon>
      </div>
    
      <nb-layout id="popoverStyle">
        <ng-template #popoverTemplate>
          <p>
            This is your Profile page, where all of the details of your NTime account are listed.<br><br>
            You can update your first or last name by changing them in the text boxes, and clicking on the Update Info button.<br>
            The email address you created your account with is also shown, but for security reasons we do not allow it to be changed.<br><br>
            To <u>change your password</u>, type your current password in the Current Password field,<br>
            and type the new password you'd like to have in the two New Password fields, then click the Change Passwords button.<br>
            A password must be at least 7 characters long, and must contain an uppercase letter, a lowercase letter, and a number.<br><br>
            The active projects you've joined are listed at the bottom of the page.<br>
            To see the archived projects you've been a part of, navigate to the Projects page by selecting "Projects" in the navigation bar.
        </ng-template>
      </nb-layout>
      
</div>
