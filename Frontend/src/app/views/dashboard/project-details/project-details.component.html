
<div class="container" [nbSpinner]="loadingProject">
    <div *ngIf="details !== null" [formGroup]="updateProjectForm">
        <div class="header">
            <div class="title">
                <h1>
                    <span>{{ details.name }}</span>
                </h1>
                <h5>
                    <span>{{ details.clientName }}</span>
                </h5>
            </div>
            <div class="actions">
                <button *ngIf="pageMode == 'view'" nbButton status="primary" (click)="copyInviteCode(details.inviteCode)">
                    <nb-icon class="adaptive-button-icon" icon="clipboard-outline"></nb-icon>
                    <span class="adaptive-button-text">Copy Invite Code</span>
                </button>
                <button *ngIf="pageMode == 'view'" nbButton status="primary" (click)="pageMode = 'edit'">
                    <nb-icon class="adaptive-button-icon" icon="edit-outline"></nb-icon>
                    <span class="adaptive-button-text">Edit Project</span>
                </button>
                <button *ngIf="pageMode == 'edit'" nbButton status="warning" (click)="cancelEdit()">
                    <nb-icon class="adaptive-button-icon" icon="close-outline"></nb-icon>
                    <span class="adaptive-button-text">Cancel Edit</span>
                </button>
                <button nbSpinnerStatus="success" *ngIf="pageMode == 'edit'" nbButton status="success" (click)="saveProjectChange()">
                    <nb-icon class="adaptive-button-icon" icon="save-outline"></nb-icon>
                    <span class="adaptive-button-text">Save Changes</span>
                </button>
            </div>
        </div>
    
        <nb-tag-list (tagRemove)="onTagRemove($event)">
            <nb-tag size="tiny" *ngIf="details.archivedDate && pageMode == 'view'" status="danger" appearance="filled" [text]="'Archived Date: ' + (details.archivedDate | date: 'dd/MM/yyyy')"></nb-tag>
            <nb-tag size="tiny" [removable]="pageMode == 'edit'" *ngFor="let tag of getAllTags()" status="info" appearance="filled" [text]="tag"></nb-tag>
            <input *ngIf="pageMode == 'edit'" type="text" status="primary" placeholder="Tags" nbTagInput (tagAdd)="onTagAdd($event)" fullWidth>
        </nb-tag-list>
    
        <p>
            <span>{{ details.description }}</span>
        </p>
    
        <h4>Team Members</h4>
        <table [nbTreeGrid]="teamDataSource">
            <tr nbTreeGridHeaderRow *nbTreeGridHeaderRowDef="gridHeaders"></tr>
            <tr nbTreeGridRow *nbTreeGridRowDef="let row; columns: gridHeaders"></tr>
        
            <ng-container nbTreeGridColumnDef="Name">
              <th nbTreeGridHeaderCell *nbTreeGridHeaderCellDef>
                Name
              </th>
              <td nbTreeGridCell *nbTreeGridCellDef="let row">{{row.data["firstName"] + " " + row.data["lastName"] || '-'}}</td>
            </ng-container>
    
            <ng-container nbTreeGridColumnDef="Role">
                <th nbTreeGridHeaderCell *nbTreeGridHeaderCellDef>
                  Role
                </th>
                <td nbTreeGridCell *nbTreeGridCellDef="let row">{{row.data["role"]}}</td>
              </ng-container>
        </table>

        <h4>
            Hourly Breakdown
        </h4>

        <div class="actions chart-actions">
            <button nbButton (click)="displayBarChart = false" status="primary">
                <nb-icon class="adaptive-button-icon" icon="trending-up-outline"></nb-icon>
                <span class="adaptive-button-text">Total Hours Spent</span>
            </button>
            <button nbButton (click)="displayBarChart = true" status="primary">
                <nb-icon class="adaptive-button-icon" icon="bar-chart-outline"></nb-icon>
                <span class="adaptive-button-text">Hours Spent By Week</span>
            </button>
        </div>

        <span id="charts">
            <ngx-charts-line-chart
                *ngIf="displayBarChart === false"
                id="line-chart"
                showXAxisLabel="true"
                showYAxisLabel="true"
                xAxis="true"
                yAxis="true"
                yScaleMin = "0"
                [yScaleMax] = "lineChartYMax"
                xAxisLabel="Week"
                [scheme]="colorScheme"
                yAxisLabel="Total Hours Spent"
                [results]="data"
                autoScale="true" >
            </ngx-charts-line-chart>
        
            <ngx-charts-bar-vertical
                *ngIf="displayBarChart === true"
                id="bar-chart"
                showXAxisLabel="true"
                showYAxisLabel="true"
                xAxis="true"
                yAxis="true"
                autoscale="true"
                xAxisLabel="Hours Spent"
                yAxisLabel="Week"
                [scheme]="colorScheme"
                [results]="barGraphData" >
            </ngx-charts-bar-vertical>
        </span>
    </div>
</div>